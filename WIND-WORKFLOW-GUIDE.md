# FastGPT Wind金融智能分析工作流详细操作指南

> **版本**: v1.0.0  
> **更新日期**: 2025-08-20  
> **适用版本**: FastGPT 4.0+  

## 📋 目录

- [1. 系统概述](#1-系统概述)
- [2. 前置准备](#2-前置准备)
- [3. 工作流创建步骤](#3-工作流创建步骤)
- [4. 节点详细配置](#4-节点详细配置)
- [5. 测试验证](#5-测试验证)
- [6. 高级配置](#6-高级配置)
- [7. 故障排除](#7-故障排除)
- [8. 版本更新记录](#8-版本更新记录)

---

## 1. 系统概述

### 1.1 功能特性

**核心能力**：
- 🎯 **全资产覆盖**: 支持12种金融资产类型（股票、债券、基金、指数、商品、期货、期权、外汇、宏观、回购、权证、行业板块）
- 🧠 **智能识别**: 自动分析用户问题类型，识别所需资产和指标
- 📊 **实时数据**: 通过Wind API获取真实金融市场数据
- 🤖 **AI分析**: 基于专业提示词的大模型智能分析
- 📈 **投资建议**: 提供明确的投资观点和风险提示

**支持的问题类型**：
- 股票分析："茅台股票投资价值如何？"
- 基金评估："易方达蓝筹精选基金怎么样？"
- 债券研究："当前国债收益率情况？"
- 指数判断："沪深300指数后市走势？"
- 商品分析："黄金期货投资机会？"
- 宏观研究："当前通胀水平分析"

### 1.2 技术架构

```
用户问题 → 问题分析 → Wind数据获取 → AI智能分析 → 结果输出
    ↓         ↓           ↓            ↓          ↓
  自然语言   资产类型     真实市场     专业分析    投资建议
  输入      智能识别     数据获取     AI处理     格式化输出
```

---

## 2. 前置准备

### 2.1 环境要求

**必需服务**：
- ✅ FastGPT 4.0+ 运行在 `http://localhost:3000`
- ✅ Wind API Service 运行在 `http://localhost:8080`
- ✅ 可用的AI模型（GPT-4推荐，或其他兼容模型）

**检查清单**：
```bash
# 1. 检查FastGPT运行状态
curl http://localhost:3000/api/health

# 2. 检查Wind API服务
curl http://localhost:8080/health

# 3. 检查Wind API数据接口
curl -X POST http://localhost:8080/api/data \
  -H "Content-Type: application/json" \
  -d '{"codes":"600519.SH","fields":"close,volume","frequency":"D"}'
```

### 2.2 权限配置

**必需权限**：
- 创建和编辑工作流权限
- AI模型调用权限
- Wind API访问权限

---

## 3. 工作流创建步骤

### 3.1 创建工作流

1. **进入创建页面**：
   ```
   访问：http://localhost:3000/dashboard/apps?parentId=&type=advanced
   ```

2. **创建新应用**：
   - 点击右上角 "**+ 新建**" 按钮
   - 选择 "**高级编排**"
   - 选择 "**工作流**"

3. **基本信息配置**：
   ```
   应用名称：金融智能分析助手
   应用描述：基于Wind数据的全资产类型金融智能分析，支持股票、债券、基金、指数、商品等多种金融产品的问答和投资建议
   应用图标：选择金融相关图标（建议选择图表或货币图标）
   ```

### 3.2 工作流设计

**节点布局**：
```
[用户输入] → [问题分析] → [Wind数据] → [AI Chat] → [结果格式化]
   100px      300px        500px       700px     900px
   200px      200px        200px       200px     200px
```

---

## 4. 节点详细配置

### 4.1 节点1：用户输入 (默认节点)

**节点类型**: userInput  
**位置**: (100, 200)  
**名称**: 用户输入  
**描述**: 接收用户提出的金融问题

**输入变量**: 无

**输出变量**：
| 变量名 | 变量类型 | 数据类型 | 描述 | 示例值 |
|--------|----------|----------|------|--------|
| `userChatInput` | static | string | 用户输入的问题文本 | "分析一下贵州茅台的投资价值" |

**配置参数**: 系统默认，无需修改

---

### 4.2 节点2：问题分析 (Code节点)

**节点类型**: code  
**位置**: (300, 200)  
**名称**: 问题分析  
**描述**: 智能分析用户问题，识别资产类型和所需指标

**输入变量**：
| 变量名 | 输入模式 | 数据类型 | 引用来源 | 描述 | 示例值 |
|--------|----------|----------|----------|------|--------|
| `userInput` | reference | string | `{{用户输入.userChatInput}}` | 用户输入的问题文本 | "分析一下贵州茅台的投资价值" |

**配置参数**：
| 参数名 | 参数值 | 描述 |
|--------|--------|------|
| `codeType` | "js" | 代码类型，固定为JavaScript |

**核心代码**：
```javascript
function main({userInput}) {
  // 智能分析用户问题，识别资产类型和所需指标
  let assetType = 'stock';  // 默认为股票
  let indicators = ['close', 'volume', 'pe_ttm', 'pb_lf'];  // 默认股票指标
  
  const input = userInput.toLowerCase();
  
  // 基金类问题识别
  if (input.includes('基金') || input.includes('净值') || input.includes('基金经理')) {
    assetType = 'fund';
    indicators = ['fund_nav', 'fund_acc_nav', 'fund_return_1y', 'fund_sharpe'];
  } 
  // 债券类问题识别
  else if (input.includes('债券') || input.includes('利率') || input.includes('收益率') || input.includes('国债')) {
    assetType = 'bond';
    indicators = ['bond_ytm', 'bond_duration', 'close', 'volume'];
  } 
  // 指数类问题识别
  else if (input.includes('指数') || input.includes('沪深300') || input.includes('中证500') || input.includes('创业板指')) {
    assetType = 'index';
    indicators = ['close', 'index_pe', 'index_pb', 'volume', 'pct_chg'];
  } 
  // 商品期货类问题识别
  else if (input.includes('期货') || input.includes('商品') || input.includes('黄金') || input.includes('原油') || input.includes('持仓')) {
    assetType = 'commodity';
    indicators = ['commodity_settle', 'commodity_oi', 'volume', 'pct_chg'];
  } 
  // 宏观经济类问题识别
  else if (input.includes('宏观') || input.includes('gdp') || input.includes('cpi') || input.includes('通胀') || input.includes('经济')) {
    assetType = 'macro';
    indicators = ['cpi', 'ppi', 'gdp_yoy', 'm2_yoy', 'shibor_3m'];
  }
  // 技术分析类问题识别
  else if (input.includes('技术') || input.includes('均线') || input.includes('macd') || input.includes('rsi')) {
    assetType = 'stock';
    indicators = ['close', 'ma5', 'ma20', 'rsi', 'macd', 'volume'];
  }
  
  // 返回分析结果
  return {
    assetType: assetType,
    indicators: indicators.join(','),
    originalQuestion: userInput,
    analysis: `识别资产类型: ${assetType}, 所需指标: ${indicators.join(', ')}`
  };
}
```

**输出变量**：
| 变量名 | 变量类型 | 数据类型 | 描述 | 示例值 |
|--------|----------|----------|------|--------|
| `assetType` | static | string | 识别的资产类型 | "stock" |
| `indicators` | static | string | 需要的指标字段(逗号分隔) | "close,volume,pe_ttm,pb_lf" |
| `originalQuestion` | static | string | 原始问题文本 | "分析一下贵州茅台的投资价值" |
| `analysis` | static | string | 分析过程描述 | "识别资产类型: stock, 所需指标: close, volume, pe_ttm, pb_lf" |

**代码逻辑说明**：
1. **输入处理**: 将用户输入转换为小写，便于关键词匹配
2. **关键词匹配**: 使用if-else结构匹配不同资产类型的关键词
3. **指标选择**: 根据资产类型选择对应的默认指标集合
4. **结果返回**: 返回资产类型、指标列表、原问题和分析描述

---

### 4.3 节点3：Wind数据获取 (Wind数据节点)

**节点类型**: Wind数据获取  
**位置**: (500, 200)  
**名称**: Wind数据获取  
**描述**: 从Wind API获取金融市场数据

**配置方法**：

1. **数据类型配置**（重要）：
   - 点击数据类型输入框
   - 选择"引用"模式（点击输入框右侧的引用图标）
   - 在弹出的选择器中选择：`问题分析` → `assetType`
   - 或者直接输入：`{{问题分析.assetType}}`
   - **注意**：如果看不到引用选项，请刷新页面重新加载

2. **其他字段配置**：
```
证券代码: (留空，系统自动推断)
指标字段: {{问题分析.indicators}} (选择引用模式)
开始日期: (留空，使用默认)
结束日期: (留空，使用默认)
数据频率: D (选择"日频")
```

**详细配置说明**：
- **windDataType**: 
  - 输入模式：选择"引用"
  - 引用值：`{{问题分析.assetType}}`
  - 说明：动态接收问题分析节点识别的资产类型
  
- **windStockCode**: 
  - 输入模式：保持默认
  - 值：留空 `""`
  - 说明：让系统从用户问题中自动提取证券代码
  
- **windIndicator**: 
  - 输入模式：选择"引用"
  - 引用值：`{{问题分析.indicators}}`
  - 说明：动态接收问题分析节点推断的指标
  
- **windStartDate**: 
  - 输入模式：保持默认
  - 值：留空 `""`
  - 说明：使用默认的近期数据
  
- **windEndDate**: 
  - 输入模式：保持默认
  - 值：留空 `""`
  - 说明：使用最新数据
  
- **windFrequency**: 
  - 输入模式：选择框
  - 值：选择 "日频" (D)
  - 说明：数据频率，一般使用日频

**输出变量**：
| 变量名 | 变量类型 | 数据类型 | 描述 | 示例值 |
|--------|----------|----------|------|--------|
| `windRawData` | static | object | 原始Wind API返回数据 | `{"errorCode":0,"data":[[1438]],"fields":["CLOSE"],"codes":["600519.SH"]}` |
| `windFormattedData` | static | string | 格式化后的数据文本(供AI分析) | "# Wind 金融数据分析报告\n\n## 贵州茅台 (600519.SH)\n..." |
| `windDataSummary` | static | object | 数据统计摘要信息 | `{"latestPrice":1438,"volume":null,"indicators":["close","volume"]}` |
| `error` | error | string | Wind API调用错误信息 | "连接超时" 或 空值 |

**数据结构详解**：

**windRawData结构**：
```json
{
  "errorCode": 0,                    // 错误码，0表示成功
  "data": [                          // 数据矩阵 [时间][代码*字段]
    [1438, null, 35.5]              // 示例：收盘价1438，成交量null，PE为35.5
  ],
  "fields": ["CLOSE", "VOLUME", "PE_TTM"],  // 字段名数组
  "codes": ["600519.SH"],            // 证券代码数组
  "times": ["2025-08-20"],           // 时间序列
  "message": "success"               // 状态消息
}
```

**windFormattedData示例**：
```markdown
# Wind 金融数据分析报告

## 贵州茅台 (600519.SH)

**最新数据 (2025-08-20):**
- CLOSE: 1438.00元
- VOLUME: --
- PE_TTM: 35.50

**统计摘要:**
- CLOSE: 最新=1438.00元, 最小=1400.00元, 最大=1500.00元, 均值=1450.00元

**数据来源:** Wind 金融终端
**更新时间:** 2025-08-20 14:30:00
```

---

### 4.4 节点4：AI智能分析 (AI Chat节点)

**节点类型**: AI Chat  
**位置**: (700, 200)  
**名称**: AI智能分析  
**描述**: 使用AI模型对Wind数据进行专业分析

**节点来源**: 左侧组件库 → AI Capability → AI Chat

**输入变量**：
| 变量名 | 输入模式 | 数据类型 | 引用来源 | 描述 | 示例值 |
|--------|----------|----------|----------|------|--------|
| `userChatInput` | manual | string | 手动组合输入 | 包含用户问题和Wind数据的完整输入模板 | 见下方模板 |

**配置参数**：
| 参数名 | 参数类型 | 参数值 | 描述 |
|--------|----------|--------|------|
| `model` | select | "gpt-4" | AI模型选择(推荐GPT-4或Claude) |
| `temperature` | number | 0.3 | 输出随机性(0.1-0.5推荐，越低越稳定) |
| `max tokens` | number | 2000 | 最大输出长度 |
| `system prompt` | textarea | 见下方 | 系统角色提示词 |

**系统提示词(System Prompt)**：
```
你是一名资深金融分析师，拥有15年投资分析经验，专精于A股、港股、债券、基金、商品期货等多个市场。

**核心能力**：
- 深度财务分析和估值建模
- 宏观经济和行业趋势研判  
- 技术分析和量化策略
- 风险管理和投资组合构建

**分析框架**：
1. **数据概览** - 总结关键指标数值和含义
2. **基本面分析** - 财务质量和经营状况评估
3. **技术面分析** - 价格趋势和技术指标判断
4. **估值分析** - 相对估值和绝对估值评估
5. **风险评估** - 识别主要风险因素和不确定性
6. **投资建议** - 明确给出投资观点(看好/中性/看空)和操作建议

**输出要求**：
- 使用专业但通俗易懂的语言
- 每个观点都要有具体数据支撑
- 给出明确的投资建议和置信度评估
- 必须包含风险提示和免责声明
- 适合普通投资者理解和参考

**重要原则**：
- 客观中立，基于数据分析
- 避免过度乐观或悲观的表述
- 强调投资风险和不确定性
- 建议投资者根据自身情况决策

请严格按照上述框架进行分析，确保建议客观专业。
```

**用户输入模板(User Chat Input)**：
```
**用户问题**: {{问题分析.originalQuestion}}

**分析识别**: {{问题分析.analysis}}

**Wind市场数据**:
{{Wind数据获取.格式化数据}}

请基于以上真实市场数据进行专业的金融分析，并给出明确的投资建议。
```

**配置步骤详解**：

1. **添加AI Chat节点**：
   - 从左侧组件库拖拽"AI Chat"到画布
   - 位置设置为(700, 200)

2. **模型配置**：
   - 选择模型：推荐"gpt-4"或"claude-3-sonnet"
   - 温度设置：0.3（确保输出稳定专业）
   - 最大token：2000（足够输出详细分析）

3. **系统提示词配置**：
   - 将上方完整的系统提示词复制粘贴到"system prompt"字段

4. **用户输入配置**：
   - 在"user chat input"字段中输入上方的用户输入模板
   - 确保引用格式正确：`{{节点名称.输出变量}}`

**变量引用说明**：
- `{{问题分析.originalQuestion}}` - 引用问题分析节点的原始问题
- `{{问题分析.analysis}}` - 引用问题分析节点的分析结果  
- `{{Wind数据获取.格式化数据}}` - 引用Wind数据节点的格式化数据输出

**输入示例**：
```
**用户问题**: 分析一下贵州茅台的投资价值

**分析识别**: 识别资产类型: stock, 所需指标: close, volume, pe_ttm, pb_lf

**Wind市场数据**:
# Wind 金融数据分析报告

## 贵州茅台 (600519.SH)

**最新数据 (2025-08-20):**
- CLOSE: 1438.00元
- VOLUME: --
- PE_TTM: 35.50

请基于以上真实市场数据进行专业的金融分析，并给出明确的投资建议。
```

**输出变量**：
| 变量名 | 变量类型 | 数据类型 | 描述 | 示例值 |
|--------|----------|----------|------|--------|
| `answerText` | static | string | AI生成的专业分析报告 | "## 贵州茅台投资价值分析\n\n### 数据概览\n当前茅台股价..." |
| `totalTokens` | static | number | 本次调用消耗的token数 | 1500 |
| `error` | error | string | AI调用错误信息 | "模型调用失败" 或 空值 |

**AI分析报告示例结构**：
```markdown
## 贵州茅台投资价值分析

### 1. 数据概览
- 当前股价：1438元，处于历史相对高位
- 市盈率(TTM)：35.5倍，略高于白酒行业平均水平
- 成交量数据暂无，需关注流动性状况

### 2. 基本面分析
[基于PE、ROE等指标的财务分析]

### 3. 估值分析
[相对估值和绝对估值评估]

### 4. 风险评估
[主要风险因素识别]

### 5. 投资建议
**投资观点**: 中性
**建议操作**: 等待回调机会  
**风险提示**: 估值偏高，注意市场波动风险
```

**重要注意事项**：
1. **节点连接**：确保AI Chat节点正确连接到Wind数据获取节点之后
2. **变量引用**：检查所有变量引用格式是否正确，特别注意节点名称要与实际一致
3. **模型选择**：建议使用GPT-4或Claude-3，效果更佳
4. **提示词调优**：可以根据实际效果调整系统提示词内容

---

### 4.5 节点5：结果格式化 (Code节点)

**节点类型**: code  
**位置**: (900, 200)  
**名称**: 结果格式化  
**描述**: 格式化最终输出结果，添加时间戳和免责声明

**输入变量**：
| 变量名 | 输入模式 | 数据类型 | 引用来源 | 描述 | 示例值 |
|--------|----------|----------|----------|------|--------|
| `userQuestion` | reference | string | `{{问题分析.originalQuestion}}` | 用户原始问题 | "分析一下贵州茅台的投资价值" |
| `aiAnalysis` | reference | string | `{{AI智能分析.answerText}}` | AI生成的分析报告 | "## 贵州茅台投资价值分析\\n\\n### 数据概览\\n..." |
| `windData` | reference | string | `{{Wind数据获取.windFormattedData}}` | 格式化的Wind数据 | "# Wind 金融数据分析报告\\n\\n## 贵州茅台..." |
| `assetType` | reference | string | `{{问题分析.assetType}}` | 资产类型标识 | "stock" |

**配置参数**：
| 参数名 | 参数值 | 描述 |
|--------|--------|------|
| `codeType` | "js" | 代码类型，固定为JavaScript |

**核心代码**：
```javascript
function main({userQuestion, aiAnalysis, windData, assetType}) {
  // 生成中文时间戳
  const timestamp = new Date().toLocaleString('zh-CN', {
    year: 'numeric',
    month: '2-digit', 
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  
  // 资产类型中文映射表
  const assetTypeMap = {
    'stock': '股票',
    'bond': '债券', 
    'fund': '基金',
    'index': '指数',
    'commodity': '商品期货',
    'futures': '期货',
    'option': '期权',
    'forex': '外汇',
    'macro': '宏观经济',
    'repo': '回购',
    'warrant': '权证',
    'sector': '行业板块'
  };
  
  // 获取中文资产类型名称
  const assetTypeCN = assetTypeMap[assetType] || '金融产品';
  
  // 构建完整的格式化报告
  const formattedResult = `# ${assetTypeCN}智能分析报告

**🔍 查询问题**: ${userQuestion}

**📊 分析时间**: ${timestamp}

**💾 数据来源**: Wind金融终端

---

${aiAnalysis}

---

## 📋 原始数据摘要

<details>
<summary>点击查看Wind原始数据</summary>

\`\`\`
${windData ? windData.substring(0, 1000) + (windData.length > 1000 ? '...' : '') : '暂无数据'}
\`\`\`

</details>

---

## ⚠️ 重要声明

**风险提示**: 
- 📈 市场有风险，投资需谨慎
- 📊 分析基于历史数据，未来表现可能不同  
- 👤 请结合个人风险承受能力做出决策
- ⏰ 市场情况瞬息万变，请关注最新信息
- 🎯 重大投资决策建议咨询专业投资顾问

**免责声明**: 本分析报告仅供参考，不构成投资建议。投资者应当独立做出投资决策并承担相应风险。

---
*📝 报告生成于: ${timestamp} | 🤖 由FastGPT+Wind数据智能生成*`;
  
  // 返回结果对象
  return {
    finalResult: formattedResult,
    timestamp: timestamp,
    assetType: assetTypeCN
  };
}
```

**输出变量**：
| 变量名 | 变量类型 | 数据类型 | 描述 | 示例值 |
|--------|----------|----------|------|--------|
| `finalResult` | static | string | 最终格式化的完整分析报告 | "# 股票智能分析报告\\n\\n**🔍 查询问题**: 分析一下贵州茅台的投资价值\\n..." |
| `timestamp` | static | string | 报告生成时间戳 | "2025/08/20 14:30:15" |
| `assetType` | static | string | 中文资产类型名称 | "股票" |

**代码逻辑说明**：
1. **时间戳生成**: 使用中文本地化格式生成当前时间，格式为 `YYYY/MM/DD HH:mm:ss`
2. **资产类型映射**: 将英文资产类型标识转换为中文名称，便于用户理解
3. **报告结构化**: 按照标准格式构建包含问题、分析、数据、声明的完整报告
4. **数据截取**: 对原始Wind数据进行截取(最多1000字符)，避免输出过长
5. **风险声明**: 添加标准的投资风险提示和免责声明，符合金融分析规范

**输出格式示例**：
```markdown
# 股票智能分析报告

**🔍 查询问题**: 分析一下贵州茅台的投资价值

**📊 分析时间**: 2025/08/20 14:30:15

**💾 数据来源**: Wind金融终端

---

## 贵州茅台投资价值分析

### 1. 数据概览
- 当前股价：1438元，处于历史相对高位
- 市盈率(TTM)：35.5倍，略高于白酒行业平均水平
...

### 5. 投资建议
**投资观点**: 中性
**建议操作**: 等待回调机会
**风险提示**: 估值偏高，注意市场波动风险

---

## ⚠️ 重要声明

**风险提示**: 
- 📈 市场有风险，投资需谨慎
...

---
*📝 报告生成于: 2025/08/20 14:30:15 | 🤖 由FastGPT+Wind数据智能生成*
```

---

### 4.6 节点连接配置

**连接顺序**：
```
用户输入 → 问题分析 → Wind数据获取 → AI Chat → 结果格式化
```

**具体连接**：
1. `用户输入.userChatInput` → `问题分析.data1`
2. `问题分析.assetType` → `Wind数据获取.数据类型`
3. `问题分析.indicators` → `Wind数据获取.指标字段`
4. 综合引用 → `AI Chat.用户输入`（手动输入组合模板）
5. `AI Chat.answerText` → `结果格式化.aiAnalysis`

**重要说明**：
- AI Chat节点不是通过连线获取输入，而是在节点内部手动配置输入模板
- 输入模板中使用变量引用语法：`{{节点名称.输出变量}}`

---

## 5. 测试验证

### 5.1 基础功能测试

**测试用例1 - 股票分析**：
```
输入: "分析一下贵州茅台的投资价值，现在能买吗？"
预期: 识别为股票类型，获取PE、PB、ROE等指标，给出明确投资建议
```

**测试用例2 - 基金评估**：
```
输入: "易方达蓝筹精选基金怎么样，值得定投吗？"
预期: 识别为基金类型，获取净值、收益率等指标，评估基金质量
```

**测试用例3 - 债券研究**：
```
输入: "当前国债收益率情况如何，有投资机会吗？"
预期: 识别为债券类型，获取收益率、久期等指标，分析债券市场
```

**测试用例4 - 指数判断**：
```
输入: "沪深300指数后市走势如何？"
预期: 识别为指数类型，获取指数PE、PB等指标，判断市场走势
```

**测试用例5 - 商品分析**：
```
输入: "黄金期货现在有投资机会吗？"
预期: 识别为商品类型，获取结算价、持仓量等指标，分析商品走势
```

### 5.2 错误处理测试

**测试场景**：
- Wind API连接失败
- 无效的股票代码
- AI模型调用失败
- 问题类型无法识别

**预期行为**：
- 显示友好的错误信息
- 提供故障排除建议
- 不会导致工作流中断

### 5.3 性能测试

**测试指标**：
- 响应时间：< 30秒
- 数据准确性：与Wind官方数据一致
- 分析质量：逻辑清晰，建议明确

---

## 6. 高级配置

### 6.1 多模型配置

**支持的AI模型**：
- GPT-4 (推荐)
- GPT-3.5-turbo
- Claude-3
- 其他OpenAI兼容模型

**模型选择建议**：
```
股票分析: GPT-4 (高精度要求)
基金评估: GPT-3.5-turbo (平衡性能和成本)
债券研究: GPT-4 (复杂计算需求)
宏观分析: GPT-4 (需要深度理解)
```

### 6.2 自定义指标配置

**添加新指标**：
1. 修改 `packages/service/core/wind/indicatorMapping.ts`
2. 添加指标配置和关键词
3. 更新问题分析逻辑
4. 重启服务

**示例 - 添加新指标**：
```typescript
// 在indicatorMapping.ts中添加
new_indicator: {
  code: 'new_indicator',
  name: '新指标',
  category: IndicatorCategory.CUSTOM,
  description: '自定义新指标',
  keywords: ['新指标', 'new_indicator']
}
```

### 6.3 自定义提示词

**按资产类型定制**：
1. 创建分类提示词模板
2. 在AI节点中使用条件判断
3. 根据资产类型选择对应模板

**示例代码**：
```javascript
// 在AI节点中动态选择提示词
const assetType = "{{问题分析.assetType}}";
let systemPrompt = "";

switch(assetType) {
  case 'stock':
    systemPrompt = "专业股票分析师提示词...";
    break;
  case 'fund':
    systemPrompt = "专业基金分析师提示词...";
    break;
  // 其他类型...
}
```

---

## 7. 故障排除

### 7.1 常见问题

**问题1**: Wind API连接失败
```
错误信息: Wind API 服务连接异常
解决方案: 
1. 检查wind-api-service是否运行在localhost:8080
2. 检查网络连接和代理设置
3. 验证API服务健康状态: curl http://localhost:8080/health
```

**问题2**: 无法识别股票代码
```
错误信息: 未找到有效的证券代码
解决方案:
1. 在问题中明确提及股票代码或公司名称
2. 检查stockMapping.ts中的公司名称映射
3. 手动在Wind数据节点中指定证券代码
```

**问题3**: AI分析结果不理想
```
错误信息: 分析结果不够专业或准确
解决方案:
1. 调整AI模型温度参数(降低到0.1-0.3)
2. 优化系统提示词，增加更详细的指导
3. 确保Wind数据质量和完整性
```

**问题4**: 工作流执行超时
```
错误信息: 工作流执行超时
解决方案:
1. 检查各节点的超时设置
2. 优化AI模型调用参数
3. 检查Wind API响应速度
```

### 7.2 调试方法

**启用调试模式**：
1. 在每个节点添加调试输出
2. 查看工作流执行日志
3. 检查Wind API原始返回数据
4. 验证变量传递是否正确

**日志检查**：
```bash
# 查看FastGPT日志
cd /Users/fuxinjie/gitfuafu/FastGPT
tail -f logs/fastgpt.log

# 查看Wind API服务日志
# (根据你的wind-api-service配置)
```

---

## 8. 版本更新记录

### v1.0.1 (2025-08-20 更新)
**修复和优化**
- ✅ 修复Wind数据节点的数据类型字段无法引用问题
- ✅ 数据类型字段现在支持引用模式和选择模式
- ✅ 更新操作文档，添加详细的引用配置说明

### v1.0.0 (2025-08-20)
**初始版本发布**
- ✅ 完整的12种资产类型支持
- ✅ 智能问题分析和资产识别
- ✅ Wind API数据获取集成
- ✅ AI智能分析和投资建议
- ✅ 专业格式化输出
- ✅ 完整的操作文档

**技术特性**：
- 支持资产类型: 股票、债券、基金、指数、商品、期货、期权、外汇、宏观、回购、权证、行业板块
- 支持指标数量: 60+ 专业金融指标
- AI模型支持: GPT-4、GPT-3.5、Claude等
- 数据来源: Wind金融终端

### 更新计划

**v1.1.0 (计划中)**
- [ ] 增加更多行业和公司覆盖
- [ ] 优化AI分析提示词模板
- [ ] 添加技术指标图表生成
- [ ] 支持批量股票对比分析

**v1.2.0 (计划中)**
- [ ] 增加实时数据订阅功能
- [ ] 添加投资组合分析功能
- [ ] 支持自定义指标计算
- [ ] 集成更多数据源

---

## 🤝 支持与反馈

**技术支持**：
- 工作流配置问题：检查本文档第4节详细配置
- API连接问题：参考第7节故障排除
- 性能优化：联系技术团队

**意见反馈**：
- 新功能建议
- 问题报告
- 使用体验改进

**文档维护**：
本文档随系统更新持续维护，请关注版本更新记录获取最新功能和修复信息。

---

*📝 文档生成时间: 2025-08-20*  
*🔄 最后更新: v1.0.0*  